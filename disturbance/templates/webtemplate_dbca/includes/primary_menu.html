{% load users %}
{% load utils %}
{% load static %}

{% is_internal as is_internal_login %}

{% if is_internal_login %}
    <!-- <li class="nav-item">
        <a class="nav-link{% if 'proposals' in request.path %} active{% endif %}" href="/internal">
            Proposals
        </a>
    </li> -->
    <li class="nav-item">
        <a class="nav-link{% if 'approvals' in request.path %} active{% endif %}" href="/internal/approvals">
            Licences
        </a>
    </li>
    <li class="nav-item">
        <a class="nav-link{% if 'compliances' in request.path %} active{% endif %}" href="/internal/compliances">
            Compliance with Requirements
        </a>
    </li>
    <li class="nav-item">
        <a class="nav-link{% if 'organisations' in request.path %} active{% endif %}" href="/internal/organisations/access">
            Organisation Access
        </a>
    </li>
    <li class="nav-item">
        <a class="nav-link" href="/internal/search">
            Search
        </a>
    </li>
    <li class="nav-item">
        <a class="nav-link" href="/internal/sites">
            Sites
        </a>
    </li>
{% else %}
    <li class="nav-item">
        <a class="nav-link" href="/external/sites">
            Sites
        </a>
    </li>
{% endif %}
<script>
    var payment_processing = 
    {
       var: { checkouthash: "{{ checkouthash }}"}
    }

    function createCookie(name, value, days) {
        var expires;
    
        if (days) {
            var date = new Date();
            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
            expires = "; expires=" + date.toGMTString();
        } else {
            expires = "";
        }
        document.cookie = encodeURIComponent(name) + "=" + encodeURIComponent(value) + expires + "; path=/;secure";
    }

    function readCookie(name) {
        var nameEQ = name + "=";
        var ca = document.cookie.split(';');
        for(var i=0;i < ca.length;i++) {
            var c = ca[i];
            while (c.charAt(0)==' ') c = c.substring(1,c.length);
            if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
        }
        return null;
    }
 
    createCookie('checkouthash', "{{ checkouthash }}");

    if (window.location.href.indexOf("payment-details") != -1) {
        setInterval(function() {
            createCookie(document.getElementById('payment-csrfmiddlewaretoken').value, "{{ checkouthash }}");
            var checkouthash_cookie = readCookie("checkouthash");
            if (payment_processing.var.checkouthash != checkouthash_cookie) {
                if ("{{is_internal_login}}" == "True") {
                    window.location = "/internal"
                } else {
                    window.location = "/external"
                }
            }		
        },"500");
    }
</script>